<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Usuarios | EduFind</title>
	<!-- core:css -->
	<link rel="stylesheet" href="/vendors/core/core.css">
	<!-- endinject -->
	<!-- plugin css for this page -->
	<link rel="stylesheet" href="/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
	<link rel="stylesheet" href="/vendors/prismjs/themes/prism.css">
	
	<link rel="stylesheet" href="/vendors/sweetalert2/sweetalert2.min.css">
	<!-- end plugin css for this page -->
	<!-- inject:css -->
	<link rel="stylesheet" href="/fonts/feather-font/css/iconfont.css">
	<link rel="stylesheet" href="/vendors/flag-icon-css/css/flag-icon.min.css">
	<!-- endinject -->
	<!-- Layout styles -->
	<link rel="stylesheet" href="/css/demo_5/style.css">
	<!-- End layout styles -->
	<link rel="shortcut icon" href="/images/favicon.png" />

	<!-- Fix datatable -->
	<link rel="stylesheet" href="/css/demo_5/custom.css">
</head>

<body>
	<div class="main-wrapper">

		<!-- partial:../../partials/_navbar.html -->
		<div class="horizontal-menu">
			<nav class="navbar top-navbar">
				<div class="container">
					<div class="navbar-content">
						<a href="#" class="navbar-brand">
							Edu<span>Find</span>
						</a>



						<ul class="navbar-nav">

							<li class="nav-item dropdown nav-notifications d-none">
								<a class="nav-link dropdown-toggle" href="#" id="notificationDropdown" role="button"
									data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<i data-feather="bell"></i>
									<div class="indicator">
										<div class="circle"></div>
									</div>
								</a>
								<div class="dropdown-menu" aria-labelledby="notificationDropdown">
									<div class="dropdown-header d-flex align-items-center justify-content-between">
										<p class="mb-0 font-weight-medium">6 New Notifications</p>
										<a href="javascript:;" class="text-muted">Clear all</a>
									</div>
									<div class="dropdown-body">
										<a href="javascript:;" class="dropdown-item">
											<div class="icon">
												<i data-feather="user-plus"></i>
											</div>
											<div class="content">
												<p>New customer registered</p>
												<p class="sub-text text-muted">2 sec ago</p>
											</div>
										</a>
										<a href="javascript:;" class="dropdown-item">
											<div class="icon">
												<i data-feather="gift"></i>
											</div>
											<div class="content">
												<p>New Order Recieved</p>
												<p class="sub-text text-muted">30 min ago</p>
											</div>
										</a>
										<a href="javascript:;" class="dropdown-item">
											<div class="icon">
												<i data-feather="alert-circle"></i>
											</div>
											<div class="content">
												<p>Server Limit Reached!</p>
												<p class="sub-text text-muted">1 hrs ago</p>
											</div>
										</a>
										<a href="javascript:;" class="dropdown-item">
											<div class="icon">
												<i data-feather="layers"></i>
											</div>
											<div class="content">
												<p>Apps are ready for update</p>
												<p class="sub-text text-muted">5 hrs ago</p>
											</div>
										</a>
										<a href="javascript:;" class="dropdown-item">
											<div class="icon">
												<i data-feather="download"></i>
											</div>
											<div class="content">
												<p>Download completed</p>
												<p class="sub-text text-muted">6 hrs ago</p>
											</div>
										</a>
									</div>
									<div class="dropdown-footer d-flex align-items-center justify-content-center">
										<a href="javascript:;">View all</a>
									</div>
								</div>
							</li>

							<li class="nav-item dropdown nav-profile">
								<a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button"
									data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<img src="https://via.placeholder.com/30x30" alt="profile">
								</a>
								<div class="dropdown-menu" aria-labelledby="profileDropdown">
									<div class="dropdown-header d-flex flex-column align-items-center">
										<div class="figure mb-3">
											<img src="https://via.placeholder.com/80x80" alt="">
										</div>
										<div class="info text-center">
											<p class="name font-weight-bold mb-0" th:text="${user.firstName + ' ' + user.lastName}">Amiah Burton</p>
											<p class="email text-muted mb-3" th:text="${user.username}">amiahburton@gmail.com</p>
										</div>
									</div>
									<div class="dropdown-body">
										<ul class="profile-nav p-0 pt-3">
											<li class="nav-item">
												<a href="/admin/cuenta" class="nav-link">
													<i data-feather="user"></i>
													<span>Mi cuenta</span>
												</a>
											</li>

											<li class="nav-item">
												<form id="logoutForm" method="post" th:action="@{/logout}">
													<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
												</form>
												<a target="_blank" class="nav-link link-logout" onclick="document.forms['logoutForm'].submit()">
													<i data-feather="log-out"></i>
													<span>Cerrar sesión</span>
												</a>
											</li>
										</ul>
									</div>
								</div>
							</li>
						</ul>
						<button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
							data-toggle="horizontal-menu-toggle">
							<i data-feather="menu"></i>
						</button>
					</div>
				</div>
			</nav>
			<nav class="bottom-navbar">
				<div class="container">
					<ul class="nav page-navigation d-flex justify-content-start">
						<li class="nav-item mr-4">
							<a class="nav-link" href="/admin">
								<i class="link-icon" data-feather="home"></i>
								<span class="menu-title">Inicio</span>
							</a>
						</li>
						<li class="nav-item mr-4 active">
							<a href="/admin/usuarios" class="nav-link">
								<i class="link-icon" data-feather="users"></i>
								<span class="menu-title">Usuarios</span>
							</a>
						</li>
						<li class="nav-item mr-4 d-none">
							<a href="/admin/catalogo" class="nav-link">
								<i class="link-icon" data-feather="book"></i>
								<span class="menu-title">Catálogo</span>
							</a>
						</li>
						<li class="nav-item mr-4">
							<a href="/admin/cuenta" class="nav-link">
								<i class="link-icon" data-feather="settings"></i>
								<span class="menu-title">Configuración</span></a>
						</li>
					</ul>
				</div>
			</nav>
		</div>
		<!-- partial -->

		<div class="page-wrapper">

			<div class="page-content">

				<nav class="page-breadcrumb">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a href="#">Usuarios</a></li>
						<li class="breadcrumb-item active" aria-current="page">Lista de usuarios</li>
					</ol>
				</nav>

				<div class="row">
					<div class="col-md-12 grid-margin stretch-card">
						<div class="card">
							<div class="card-header">
								<h6 class="card-title mb-0 mt-1">Lista de usuarios</h6>
							</div>

							<div class="card-body">

								<div class="input-group col-xs-12 mb-4">
									<input id="mySearchInput" type="text" class="form-control" placeholder="Ingrese un texto para la búsqueda">
								</div>

								<div class="mb-4">
									<a href="/admin/usuarios/nuevo" class="btn btn-primary btn-icon-text">
										<i class="btn-icon-prepend" data-feather="user-plus"></i>
										Nuevo usuario
									</a>
								</div>

								<div class="table-responsive">
									<table id="dataTableExample" class="table">
										<thead>
											<tr>
												<th>Id</th>
												<th>Usuario</th>
												<th>Nombre</th>
												<th>Rol</th>
												<th>Estado</th>
												<th>Acción</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="user: ${users}">
												<td th:text="${user.id}">1</td>
												<td th:text="${user.username}">Angel</td>
												<td th:if="${user.roles[0].name == 'ROLE_CENTER'}" th:text="${user.name}"></td>
												<td th:unless="${user.roles[0].name == 'ROLE_CENTER'}" th:text="${user.firstName + ' ' + user.lastName}"></td>
												<td th:text="${#strings.substringAfter(user.roles[0].name, '_')}">Centro</td>
												<td>
													<span class="badge badge-success" th:if="${user.status}">Activo</span>
													<span class="badge badge-secondary" th:unless="${user.status}">Inactivo</span>
												</td>
												<td>
													<div>
														<button class="btn btn-secondary btn-icon mr-2 disableUser" th:if="${user.status}" 
															data-toggle="modal" data-target="#disableModal" th:attr="data-id=${user.id}">
															<i class="btn-icon-prepend" data-feather="user-x"></i>
														</button>
														<button class="btn btn-success btn-icon mr-2 enableUser" th:unless="${user.status}"
															data-toggle="modal" data-target="#enableModal" th:attr="data-id=${user.id}">
															<i class="btn-icon-prepend" data-feather="user-check"></i>
														</button>
														
														<a th:href="@{/admin/usuarios/editar/{id}(id=${user.id})}" href="#" class="btn btn-warning btn-icon mr-2">
															<i class="btn-icon-prepend" data-feather="edit"></i>
														</a>
														<button class="btn btn-danger btn-icon deleteUser d-none" data-toggle="modal" data-target="#deleteModal" th:attr="data-id=${user.id}">
															<i class="btn-icon-prepend" data-feather="delete"></i>
														</button>
													</div>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

			<!-- Modal -->
			<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel"
				aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="deleteModalLabel">Confirmar</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							¿Está seguro de que desea eliminar de forma permanente este usuario?
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
							<a id="btnDeleteUser" type="button" class="btn btn-primary">Eliminar</a>
						</div>
					</div>
				</div>
			</div>
			<!-- end Modal -->

			<!-- Modal -->
			<div class="modal fade" id="enableModal" tabindex="-1" role="dialog" aria-labelledby="enableModalLabel"
				aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="enableModalLabel">Confirmar</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							¿Está seguro de que desea activar la cuenta del usuario?
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
							<a id="btnEnableUser" type="button" class="btn btn-primary">Activar</a>
						</div>
					</div>
				</div>
			</div>
			<!-- end Modal -->

			<!-- Modal -->
			<div class="modal fade" id="disableModal" tabindex="-1" role="dialog" aria-labelledby="disableModalLabel"
				aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="disableModalLabel">Confirmar</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							¿Está seguro de que desea desactivar la cuenta del usuario?
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
							<a id="btnDisableUser" type="button" class="btn btn-primary">Desactivar</a>
						</div>
					</div>
				</div>
			</div>
			<!-- end Modal -->

			<!-- partial:../../partials/_footer.html -->
			<footer class="footer d-flex flex-column flex-md-row align-items-center justify-content-between">
				<p class="text-muted text-center text-md-left">Copyright © 2021 <a href="#" target="_blank">EduFind</a>.
					Todos los derechos reservados</p>
				<p class="text-muted text-center text-md-left mb-0 d-none d-md-block">Desarrollado con <i
						class="mb-1 text-primary ml-1 icon-small" data-feather="heart"></i></p>
			</footer>
			<!-- partial -->

		</div>
	</div>

	<!-- core:js -->
	<script src="/vendors/core/core.js"></script>
	<!-- endinject -->
	<!-- plugin js for this page -->
	<script src="/vendors/datatables.net/jquery.dataTables.js"></script>
	<script src="/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>

	<script src="/vendors/prismjs/prism.js"></script>
	<script src="/vendors/clipboard/clipboard.min.js"></script>
	
	<script src="/vendors/sweetalert2/sweetalert2.min.js"></script>
	<!-- end plugin js for this page -->
	<!-- inject:js -->
	<script src="/vendors/feather-icons/feather.min.js"></script>
	<script src="/js/template.js"></script>
	<!-- endinject -->
	<!-- custom js for this page -->
	<script src="/js/data-table-user.js"></script>
	<!-- end custom js for this page -->

	<script th:inline="javascript">
		$('.disableUser').click(function () {
			let userId = $(this).attr('data-id');
			$('#btnDisableUser').attr('href', '/admin/usuarios/cambiarEstado/' + userId);
		});
		
		$('.enableUser').click(function () {
			let userId = $(this).attr('data-id');
			$('#btnEnableUser').attr('href', '/admin/usuarios/cambiarEstado/' + userId);
		});
		
		$('.deleteUser').click(function () {
			let  userId = $(this).attr('data-id');
			$('#btnDeleteUser').attr('href', '/admin/usuarios/eliminar/' + userId);
		});
		
		$(function() {
			var notification = /*[[${notification}]]*/
			
			'use strict'
			
			if (notification === 'Usuario eliminado') {
				Swal.fire({
				  position: 'center',
				  icon: 'success',
				  title: notification,
				  showConfirmButton: false,
				  timer: 1500
				})
			} else if (notification === 'Usuario actualizado') {
				Swal.fire({
				  position: 'center',
				  icon: 'success',
				  title: notification,
				  showConfirmButton: false,
				  timer: 1500
				})
			} else if (notification === 'Usuario creado') {
				Swal.fire({
				  position: 'center',
				  icon: 'success',
				  title: notification,
				  showConfirmButton: false,
				  timer: 1500
				})
			} else if (notification === 'Usuario activado') {
				Swal.fire({
				  position: 'center',
				  icon: 'success',
				  title: notification,
				  showConfirmButton: false,
				  timer: 1500
				})
			} else if (notification === 'Usuario desactivado') {
				Swal.fire({
				  position: 'center',
				  icon: 'success',
				  title: notification,
				  showConfirmButton: false,
				  timer: 1500
				})
			}
		})
	</script>
</body>

</html>